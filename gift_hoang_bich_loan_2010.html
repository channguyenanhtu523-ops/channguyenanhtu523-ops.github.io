<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Heart Gift 3D — Hoàng Bích Loan</title>
  <style>
    html,body {margin:0;height:100%;background:#000;overflow:hidden;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    #note {position:fixed;left:12px;bottom:12px;color:#aaa;font-size:12px;opacity:.85}
    canvas{display:block}
  </style>
</head>
<body>
  <div id="note">Dành tặng: Hoàng Bích Loan • 20/10</div>
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script>
    // ====== NỘI DUNG CỐ ĐỊNH ======
    const TEXT1 = "Chúc nàng 20/10 thật hạnh phúc";
    const TEXT2 = "Luôn xinh đẹp và may mắn";
    const TEXT3 = "Ngập tràn niềm vui mau chóng cưới em nhé";

    // ====== CẤU HÌNH ======
    const CONFIG = { heartPoints: 9000, heartSize: 2.2, ringY: [-1.2,-1.8,-2.4], ringRadius:[2.0,2.6,3.2], ringCount: 28, textColor: "#ffffff" };

    // ====== CẢNH ======
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 10, 35);
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
    camera.position.set(0, 0.8, 6);
    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setClearColor(0x000000);
    document.body.appendChild(renderer.domElement);
    scene.add(new THREE.AmbientLight(0x404040, 1.1));
    const light = new THREE.PointLight(0xffffff, 10, 50); light.position.set(0,5,8); scene.add(light);

    // ====== HẠT TRÁI TIM ======
    function heartImplicit(x,y,z){ const a=x*x+2.25*y*y+z*z-1; return a*a*a - x*x*z*z*z - 0.1125*y*y*z*z*z; }
    function buildHeartPoints(n=8000,size=2.0){
      const pos=new Float32Array(n*3); let i=0, tries=0;
      while(i<n && tries<n*50){
        const x=(Math.random()*2-1)*1.3, y=(Math.random()*2-1)*1.3, z=(Math.random()*2-1)*1.3;
        if(Math.abs(heartImplicit(x,y,z))<0.03){ pos[i*3]=x*size; pos[i*3+1]=y*size; pos[i*3+2]=z*size; i++; }
        tries++;
      }
      const g=new THREE.BufferGeometry(); g.setAttribute('position', new THREE.BufferAttribute(pos,3));
      const col=new Float32Array(n*3);
      for(let k=0;k<n;k++){ const p=k*3, yy=pos[p+1]/size; const r=0.8+0.2*Math.random(), g1=0.08+0.15*(yy+1)/2, b=0.1+0.18*Math.random(); col[p]=r; col[p+1]=g1; col[p+2]=b; }
      g.setAttribute('color', new THREE.BufferAttribute(col,3));
      const m=new THREE.PointsMaterial({ size:0.05, sizeAttenuation:true, vertexColors:true, transparent:true, opacity:0.95, depthWrite:false, blending:THREE.AdditiveBlending });
      const pts=new THREE.Points(g,m); pts.name='heart'; return pts;
    }
    const heart = buildHeartPoints(CONFIG.heartPoints, CONFIG.heartSize); scene.add(heart);

    // ====== SAO ======
    (function stars(){ const n=2000,r=30,pos=new Float32Array(n*3);
      for(let i=0;i<n;i++){ const phi=Math.acos(2*Math.random()-1), th=Math.random()*Math.PI*2, rr=r*(0.8+0.2*Math.random());
        pos[i*3]=rr*Math.sin(phi)*Math.cos(th); pos[i*3+1]=rr*Math.cos(phi); pos[i*3+2]=rr*Math.sin(phi)*Math.sin(th); }
      const g=new THREE.BufferGeometry(); g.setAttribute('position', new THREE.BufferAttribute(pos,3));
      const m=new THREE.PointsMaterial({ size:0.03, color:0xffffff, depthWrite:false, opacity:.6, transparent:true }); scene.add(new THREE.Points(g,m));
    })();

    // ====== VÒNG CHỮ ======
    function makeTextSprite(text,color="#ffffff",font='700 64px system-ui'){
      const canvas=document.createElement('canvas'); canvas.width=1024; canvas.height=256; const ctx=canvas.getContext('2d');
      ctx.fillStyle=color; ctx.font=font; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.shadowColor='#fff'; ctx.shadowBlur=6; ctx.fillText(text,512,128);
      const tex=new THREE.CanvasTexture(canvas); tex.anisotropy=8; const mat=new THREE.SpriteMaterial({map:tex,transparent:true});
      const sprite=new THREE.Sprite(mat); sprite.scale.set(2.4,0.6,1); return sprite;
    }
    function buildTextRing(text, radius=2.2, y=-1.2, count=28, speed=0.25){
      const g=new THREE.Group();
      for(let i=0;i<count;i++){ const s=makeTextSprite(text); const a=i*Math.PI*2/count; s.position.set(Math.cos(a)*radius,y,Math.sin(a)*radius); s.rotation.y=-a+Math.PI/2; g.add(s); }
      g.userData.speed=speed; scene.add(g); return g;
    }
    const rings=[
      buildTextRing(TEXT1, 2.0, -1.2, 28, 0.15),
      buildTextRing(TEXT2, 2.6, -1.8, 28, 0.22),
      buildTextRing(TEXT3, 3.2, -2.4, 28, 0.29),
    ];

    // ====== ANIMATE ======
    let t=0; function animate(){ requestAnimationFrame(animate); t+=0.005; heart.rotation.y+=0.003; heart.position.y = Math.sin(t*1.6)*0.08; rings.forEach(g=> g.rotation.y += (g.userData.speed||0.2)*0.01); renderer.render(scene,camera);} animate();
    addEventListener('resize', ()=>{ camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
  </script>
</body>
</html>
